{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Nexosoft ‚Äì Recuperar contrase√±a</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/login.css' %}">
</head>

<body>
<div class="app-wrapper">

  <!-- HEADER -->
  <header class="main-header">
    <div class="brand">
      <img src="{% static 'img/logo.png' %}" alt="NEXOSOFT Logo">
    </div>

    <div class="header-actions">
      <a href="{% url 'landing' %}" class="btn-outline">Volver a la tienda</a>
      <a href="{% url 'login' %}" class="btn-primary">Iniciar sesi√≥n</a>
    </div>
  </header>

  <main>
    <!-- MENSAJES -->
    {% if messages %}
    <div class="auth-messages">
      {% for message in messages %}
      <div class="auth-message {{ message.tags }}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <section class="auth-wrapper">
      <article class="auth-card">

        <div class="auth-header">
          <h1 class="auth-title">Recuperar contrase√±a</h1>
          <p class="auth-subtitle">
            Ingresa tu correo y una nueva contrase√±a para tu cuenta de Nexosoft.
          </p>
        </div>

        <form id="recuperarForm" method="post" action="{% url 'recuperar_clave' %}" novalidate>
          {% csrf_token %}
          <div class="auth-body">
            <!-- CORREO -->
            <div class="form-group">
              <label for="recEmail">Correo electr√≥nico</label>
              <input
                id="recEmail"
                name="correoElectronico"
                type="email"
                class="form-input"
                placeholder="correo@gmail.com"
                required
                maxlength="60"
                pattern="^[^@\s]+@(gmail\.com|hotmail\.com|outlook\.com|yahoo\.com)$"
                title="Solo se permiten correos de Gmail, Hotmail, Outlook o Yahoo."
              />
              <div class="field-error"></div>
            </div>

            <!-- NUEVA CONTRASE√ëA -->
            <div class="form-group">
              <label for="recPass1">Nueva contrase√±a</label>
              <div class="password-wrapper">
                <input
                  id="recPass1"
                  name="password"
                  type="password"
                  class="form-input"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  required
                  minlength="8"
                  maxlength="32"
                  title="Debe tener entre 8 y 32 caracteres, con may√∫sculas, min√∫sculas, n√∫meros y s√≠mbolos."
                />
                <span class="toggle-password" data-target="recPass1">üëÅ</span>
              </div>
              <div class="field-error"></div>
            </div>

            <!-- CONFIRMAR CONTRASE√ëA -->
            <div class="form-group">
              <label for="recPass2">Confirmar contrase√±a</label>
              <div class="password-wrapper">
                <input
                  id="recPass2"
                  name="password2"
                  type="password"
                  class="form-input"
                  placeholder="Repite tu contrase√±a"
                  required
                />
                <span class="toggle-password" data-target="recPass2">üëÅ</span>
              </div>
            </div>
          </div>

          <div class="auth-footer">
            <span class="auth-footer-text">
              <a href="{% url 'login' %}" class="link-inline">Volver al login</a>
            </span>

            <button type="submit" class="btn-primary">
              Actualizar contrase√±a
            </button>
          </div>
        </form>

      </article>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-bottom">
      <span>¬© 2025 NEXOSOFT. Todos los derechos reservados.</span>
      <span class="footer-made-with">
        Hecho con <span class="footer-heart">‚ù§</span> para nuestros clientes
      </span>
    </div>
  </footer>
</div>

<!-- VALIDACI√ìN FRONTEND B√ÅSICA + OJITO -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("recuperarForm");
  if (!form) return;

  const campos = form.querySelectorAll("input[required]");

  function obtenerMensajeError(campo) {
    const v = campo.validity;
    const name = campo.name;

    if (v.valueMissing) {
      switch (name) {
        case "correoElectronico": return "Ingresa tu correo electr√≥nico.";
        case "password":         return "Ingresa una nueva contrase√±a.";
        case "password2":        return "Repite tu nueva contrase√±a.";
        default:                 return "Este campo es obligatorio.";
      }
    }

    if (v.typeMismatch && campo.type === "email") {
      return "Ingresa un correo electr√≥nico v√°lido.";
    }

    if (v.patternMismatch && name === "correoElectronico") {
      return "Ingresa un correo v√°lido (gmail, hotmail, outlook o yahoo).";
    }

    if ((v.tooShort || v.tooLong) && name === "password") {
      return "La contrase√±a debe tener entre 8 y 32 caracteres.";
    }

    return "";
  }

  function mostrarError(campo, mensaje) {
    const grupo = campo.closest(".form-group");
    if (!grupo) return;

    campo.classList.add("input-error");
    let errorDiv = grupo.querySelector(".field-error");
    if (!errorDiv) {
      errorDiv = document.createElement("div");
      errorDiv.className = "field-error";
      grupo.appendChild(errorDiv);
    }
    errorDiv.textContent = mensaje;
  }

  function limpiarError(campo) {
    const grupo = campo.closest(".form-group");
    if (!grupo) return;

    campo.classList.remove("input-error");
    const errorDiv = grupo.querySelector(".field-error");
    if (errorDiv) errorDiv.textContent = "";
  }

  function validarCampo(campo) {
    campo.setCustomValidity("");
    let mensaje = obtenerMensajeError(campo);

    if (!mensaje && campo.name === "password2") {
      const pass1 = form.querySelector('input[name="password"]');
      if (pass1 && campo.value !== pass1.value) {
        mensaje = "Las contrase√±as no coinciden.";
      }
    }

    if (mensaje) {
      mostrarError(campo, mensaje);
      return false;
    } else {
      limpiarError(campo);
      return true;
    }
  }

  form.addEventListener("submit", (e) => {
    let valido = true;
    let primero = null;

    campos.forEach(campo => {
      const ok = validarCampo(campo);
      if (!ok && !primero) {
        primero = campo;
        valido = false;
      }
    });

    if (!valido) {
      e.preventDefault();
      if (primero) primero.focus();
    }
  });

  campos.forEach(campo => {
    campo.addEventListener("input", () => validarCampo(campo));
  });

  document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", () => {
      const input = document.getElementById(btn.dataset.target);
      if (!input) return;
      input.type = input.type === "password" ? "text" : "password";
    });
  });
});
</script>


</body>
</html>
