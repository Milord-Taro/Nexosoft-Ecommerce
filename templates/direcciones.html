{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>NEXOSOFT ‚Äì Direcciones de env√≠o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Estilos globales de la tienda -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
  <div class="app-wrapper">

    <header class="main-header">
      <div class="brand">
        <a href="{% url 'landing' %}">
          <img src="{% static 'img/logo.png' %}" alt="NEXOSOFT Logo">
        </a>
      </div>

      <div class="header-actions">
        <a href="{% url 'landing' %}" class="btn-outline">Volver a la tienda</a>
        <a href="{% url 'logout' %}" class="btn-primary">Cerrar sesi√≥n</a>
      </div>
    </header>

    {% if messages %}
      <div class="auth-messages">
        {% for message in messages %}
          <div class="auth-message {{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <main>
      <section class="perfil-section">
        <div class="perfil-wrapper">

          <!-- SIDEBAR -->
          <aside class="perfil-sidebar">
            <h2 class="perfil-sidebar-title">Mi cuenta</h2>
            <nav class="perfil-menu">
              <a href="{% url 'perfil' %}"
                 class="perfil-menu-item {% if active_section == 'perfil' %}{% endif %}">
                Datos personales
              </a>

              <a href="{% url 'direcciones' %}"
                 class="perfil-menu-item {% if active_section == 'direcciones' %}perfil-menu-item--active{% endif %}">
                Direcciones de env√≠o
              </a>

              <button type="button" class="perfil-menu-item" disabled>
                Mis pedidos
              </button>
              <button type="button" class="perfil-menu-item" disabled>
                Seguridad
              </button>
            </nav>
          </aside>

          <!-- CONTENIDO PRINCIPAL -->
          <div class="perfil-main">

            <!-- LISTA DE DIRECCIONES -->
            <section class="perfil-main-card">
              <h1 class="perfil-title">Direcciones de env√≠o</h1>
              <p class="perfil-subtitle">
                Gestiona las direcciones donde quieres recibir tus pedidos.
              </p>

              {% if direcciones %}
                <div class="direcciones-list">
                  {% for d in direcciones %}
                    <article class="direccion-item">
                      <div class="direccion-main">
                        <div class="direccion-contacto">
                          <strong>{{ d.nombreContacto }}</strong>
                          {% if d.esPrincipal %}
                            <span class="direccion-badge">Principal</span>
                          {% endif %}
                        </div>
                        <div class="direccion-line">
                          {{ d.ciudad }} ‚Äì {{ d.barrio }}
                          {% if d.complemento %}
                            ¬∑ {{ d.complemento }}
                          {% endif %}
                        </div>
                        <div class="direccion-line direccion-phone">
                          Tel: {{ d.telefonoContacto }}
                        </div>
                      </div>

                      <div class="direccion-actions">
                        {% if not d.esPrincipal %}
                          <form method="post" class="direccion-inline-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="marcar_principal">
                            <input type="hidden" name="direccion_id" value="{{ d.id }}">
                            <button type="submit" class="btn-outline-sm">
                              Marcar como principal
                            </button>
                          </form>
                        {% endif %}
                                            
                        <!-- Bot√≥n para editar (no env√≠a POST, solo activa el formulario de abajo) -->
                        <button
                          type="button"
                          class="btn-outline-sm direccion-edit-btn"
                          data-id="{{ d.id }}"
                          data-nombre="{{ d.nombreContacto }}"
                          data-telefono="{{ d.telefonoContacto }}"
                          data-ciudad="{{ d.ciudad }}"
                          data-barrio="{{ d.barrio }}"
                          data-complemento="{{ d.complemento|default:'' }}"
                          data-es-principal="{{ d.esPrincipal|yesno:'1,0' }}"
                        >
                          Editar
                        </button>
                        
                        <form method="post" class="direccion-inline-form">
                          {% csrf_token %}
                          <input type="hidden" name="action" value="delete">
                          <input type="hidden" name="direccion_id" value="{{ d.id }}">
                          <button type="submit" class="btn-danger-sm">
                            Eliminar
                          </button>
                        </form>
                      </div>

                    </article>
                  {% endfor %}
                </div>
              {% else %}
                <p style="font-size:0.9rem; color:#6b7280;">
                  A√∫n no tienes direcciones guardadas.
                </p>
              {% endif %}
            </section>

            <!-- FORMULARIO: NUEVA DIRECCI√ìN -->
            <section class="perfil-main-card">
              <h1 class="perfil-title">Direcciones de env√≠o</h1>
              <p class="perfil-subtitle">
                Guarda una o varias direcciones para tus pedidos. Podr√°s elegir la principal al momento de comprar.
              </p>
            
              <!-- FORM: AGREGAR / EDITAR DIRECCI√ìN -->
              <h2 class="perfil-block-title">Agregar nueva direcci√≥n</h2>
            
              <form method="post" class="perfil-form" id="direccion-form">
                {% csrf_token %}
                <!-- üëá importante: coincide con la vista -->
                <input type="hidden" name="action" value="crear" id="direccion_form_action">
                <input type="hidden" name="direccion_id" id="direccion_id">
                
            
                <div class="perfil-grid">
                  <div class="perfil-field">
                    <label for="id_nombre_contacto" class="perfil-label">Nombre de quien recibe</label>
                    <input
                      type="text"
                      id="id_nombre_contacto"
                      name="nombreContacto"
                      class="perfil-input"
                      required
                    >
                  </div>
            
                  <div class="perfil-field">
                    <label for="id_telefono_contacto" class="perfil-label">Tel√©fono de quien recibe</label>
                    <input
                      type="text"
                      id="id_telefono_contacto"
                      name="telefonoContacto"
                      class="perfil-input"
                      required
                    >
                  </div>
            
                  <div class="perfil-field">
                    <label for="id_ciudad" class="perfil-label">Ciudad</label>
                    <select
                      id="id_ciudad"
                      name="ciudad"
                      class="perfil-input"
                      required
                    >
                      <option value="">Selecciona una ciudad...</option>
                      <option value="Bogot√°">Bogot√°</option>
                      <option value="Medell√≠n">Medell√≠n</option>
                      <option value="Cali">Cali</option>
                      <option value="Barranquilla">Barranquilla</option>
                      <!-- puedes ir sumando m√°s -->
                    </select>
                  </div>
                  
                  <div class="perfil-field">
                    <label for="id_barrio" class="perfil-label">Barrio / Localidad</label>
                    <select
                      id="id_barrio"
                      name="barrio"
                      class="perfil-input"
                      required
                    >
                      <option value="">Primero selecciona una ciudad</option>
                    </select>
                  </div>
                    
            
                  <div class="perfil-field perfil-field-full">
                    <label for="id_complemento" class="perfil-label">Direcci√≥n completa</label>
                    <input
                      type="text"
                      id="id_complemento"
                      name="complemento"
                      class="perfil-input"
                      placeholder="Ej: Calle 10 # 25-36 Apto 302, Torre B"
                      required
                    >
                  </div>
            
                  <div class="perfil-field perfil-field-full">
                    <label class="checkbox-label">
                      <input type="checkbox" name="esPrincipal">
                      Usar como direcci√≥n principal
                    </label>
                  </div>
                </div>
            
                <div class="perfil-footer">
                  <button type="submit" class="btn-primary">
                    Guardar direcci√≥n
                  </button>
                </div>
              </form>
            </section>

          </div>
        </div>

        
      </section>

      
    </main>

    <!-- ==========================================================
             FOOTER
        ========================================================== -->
        <footer class="site-footer">
          <div class="footer-top">
            <div class="footer-brand">
              <div class="footer-brand-logo">
                <div class="footer-logo-icon">N</div>
                <span class="footer-brand-name">NEXOSOFT</span>
              </div>
              <p class="footer-brand-text">
                Tu tienda en l√≠nea de herramientas y productos de ferreter√≠a de confianza.
              </p>
            </div>
    
            <div class="footer-column">
              <h4>Enlaces R√°pidos</h4>
              <ul>
                <li>Sobre Nosotros</li>
                <li>T√©rminos y Condiciones</li>
                <li>Pol√≠tica de Privacidad</li>
                <li>Preguntas Frecuentes</li>
                <li>PQR - Peticiones, Quejas y Reclamos</li>
                <!-- üëá DEMOS DE ERRORES -->
                <li><a href="{% url 'demo_404' %}">Error 404</a></li>
                <li><a href="{% url 'demo_500' %}">Error 500</a></li>
              </ul>
            </div>
    
            <div class="footer-column">
              <h4>Contacto</h4>
              <ul>
                <li>Email: info@nexosoft.com</li>
                <li>Tel√©fono: +57 3000000001</li>
                <li>Direcci√≥n: Sena</li>
                <li>Bogot√°, Colombia</li>
              </ul>
            </div>
          </div>
          
          <div class="footer-bottom">
            <span>¬© 2025 NEXOSOFT. Todos los derechos reservados.</span>
            <span class="footer-made-with">
              Hecho con <span class="footer-heart">‚ù§</span> para nuestros clientes
            </span>
          </div>
        </footer>
      </div>
  </div>

  <script src="{% static 'js/direcciones.js' %}"></script>

</body>
</html>
