{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexosoft ‚Äì Tienda</title>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">

  <!-- JS -->
  <script src="{% static 'js/app.js' %}" defer></script>
</head>

<body>
  <div class="app-wrapper">

    <!-- ==========================================================
         HEADER
    ========================================================== -->
    <header class="main-header">
      <div class="brand">
        <img src="{% static 'img/logo.png' %}" alt="NEXOSOFT Logo">
      </div>

      <div class="header-search">
        <input type="text" placeholder="Buscar productos...">
      </div>

      <div class="header-actions">
        <a
          href="{% url 'demo_500' %}"
          class="cart-btn"
          id="cartBtn"
          title="Simular error 500"
        >
          üõí
          <span id="cartCount" class="cart-count">0</span>
        </a>
        
        <!-- üî• Aqu√≠ est√° el bot√≥n que cambia si hay un usuario logueado -->
        {% if request.session.usuario_id %}
          <span class="user-greeting">
            Hola, {{ request.session.usuario_nombre }}
          </span>
          <a href="{% url 'logout' %}" class="btn-outline">Cerrar sesi√≥n</a>
        {% else %}
          <a id="loginBtn" href="{% url 'login' %}" class="btn-outline">Ingresar</a>
        {% endif %}
        
        <a href="{% url 'demo_404' %}" class="btn-primary" title="Simular error 404">
          Vender
        </a>
        
      </div>
    </header>

    <!-- ==========================================================
         TIENDA
    ========================================================== -->
    <main>
      <section id="tiendaSection">
        <div class="store-header-row">
          <div>
            <h2 class="store-title">Categor√≠as</h2>
            <p class="store-subtitle">Explora nuestras herramientas y productos de ferreter√≠a.</p>
          </div>
        </div>

        <!-- Categor√≠as -->
        <div class="category-bar" id="categoryBar">
          <button class="category-pill active" data-category="Todos">Todos</button>
          <button class="category-pill" data-category="Herramientas El√©ctricas">Herramientas El√©ctricas</button>
          <button class="category-pill" data-category="Herramientas Manuales">Herramientas Manuales</button>
          <button class="category-pill" data-category="Pintura">Pintura</button>
          <button class="category-pill" data-category="Escaleras">Escaleras</button>
          <button class="category-pill" data-category="Medici√≥n">Medici√≥n</button>
        </div>

        <!-- Grid de productos -->
        <div class="products-grid" id="productsGrid"></div>
      </section>
    </main>

    <!-- ==========================================================
         FOOTER
    ========================================================== -->
    <footer class="site-footer">
      <div class="footer-top">
        <div class="footer-brand">
          <div class="footer-brand-logo">
            <div class="footer-logo-icon">N</div>
            <span class="footer-brand-name">NEXOSOFT</span>
          </div>
          <p class="footer-brand-text">
            Tu tienda en l√≠nea de herramientas y productos de ferreter√≠a de confianza.
          </p>
        </div>

        <div class="footer-column">
          <h4>Enlaces R√°pidos</h4>
          <ul>
            <li>Sobre Nosotros</li>
            <li>T√©rminos y Condiciones</li>
            <li>Pol√≠tica de Privacidad</li>
            <li>Preguntas Frecuentes</li>
            <li>PQR - Peticiones, Quejas y Reclamos</li>
          </ul>
        </div>

        <div class="footer-column">
          <h4>Contacto</h4>
          <ul>
            <li>Email: info@nexosoft.com</li>
            <li>Tel√©fono: +57 3000000001</li>
            <li>Direcci√≥n: Sena</li>
            <li>Bogot√°, Colombia</li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <span>¬© 2025 NEXOSOFT. Todos los derechos reservados.</span>
        <span class="footer-made-with">
          Hecho con <span class="footer-heart">‚ù§</span> para nuestros clientes
        </span>
      </div>
    </footer>
  </div>

  <!-- ==========================================================
       MODAL DE PRODUCTO
  ========================================================== -->
  <div id="productModal" class="modal-overlay modal-hidden">
    <div class="modal-card">

      <button type="button" class="modal-close" id="modalCloseBtn">&times;</button>

      <div class="modal-content">
        <div class="modal-image-wrapper">
          <img id="modalImage" src="" alt="Imagen del producto">
        </div>

        <div class="modal-info">
          <span class="modal-tag" id="modalCategory">Categor√≠a</span>
          <h2 class="modal-title" id="modalTitle">T√≠tulo del producto</h2>
          <p class="modal-meta" id="modalMeta">Vendedor ‚Ä¢ Rating ‚Ä¢ Ventas</p>
          <div class="modal-price" id="modalPrice">$0.00</div>

          <h3 class="modal-section-title">Descripci√≥n</h3>
          <p class="modal-desc" id="modalDescription"></p>

          <h3 class="modal-section-title">Caracter√≠sticas</h3>
          <ul class="modal-features" id="modalFeatures"></ul>
        </div>
      </div>

      <div class="modal-footer">
        <div class="modal-stock">
          Disponibilidad:
          <span class="badge-stock">
            <span class="badge-dot"></span>
            <span id="modalStockText">En stock</span>
          </span>
        </div>

        <button class="modal-btn-primary" type="button" id="modalAddCartBtn">
          Agregar al carrito
        </button>
      </div>

    </div>
  </div>


 <!-- ==========================================================
    SISTEMA DE SESI√ìN 
========================================================== -->
<script>
  const loginBtn = document.getElementById("loginBtn");

  // Verificar sesi√≥n
  const sesionActiva = localStorage.getItem("sesionActiva") === "true";
  const usuarioActual = JSON.parse(localStorage.getItem("usuarioActual"));

  if (sesionActiva && usuarioActual) {
    // Cambiar bot√≥n "Ingresar" ‚Üí Nombre del usuario
    loginBtn.textContent = usuarioActual.nombre;
    loginBtn.href = "#";
    loginBtn.classList.remove("btn-outline");
    loginBtn.classList.add("btn-primary");

    // Crear bot√≥n de Cerrar sesi√≥n
    const logoutBtn = document.createElement("button");
    logoutBtn.textContent = "Cerrar sesi√≥n";
    logoutBtn.classList.add("btn-outline");
    logoutBtn.style.marginLeft = "10px";

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("sesionActiva");
      localStorage.removeItem("usuarioActual");
      location.reload();
    });

    // Insertar bot√≥n al lado del nombre
    loginBtn.parentNode.appendChild(logoutBtn);
  }
</script>

</body>
</html>
